<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>BFS Interior Door Takeoff</title>

<style>

/* ===== Basic Reset ===== */
* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}
body {
  font-family: Arial, Helvetica, sans-serif;
  background: #f4f4f4;
  padding: 20px;
  color: #222;
}

/* ===== Container ===== */
.container {
  max-width: 900px;
  margin: 0 auto 50px auto;
  background: #fff;
  padding: 20px;
  border-radius: 8px;
  box-shadow: 0 2px 4px #0002;
}

/* ===== Headings ===== */
h1, h2, h3 {
  margin-bottom: 16px;
  font-weight: 700;
  color: #003366;
}

.section-title {
  margin-top: 40px;
  margin-bottom: 6px;
  padding: 8px 12px;
  background: #003366;
  color: #fff;
  border-radius: 5px 5px 0 0;
  font-size: 1.1rem;
}

label {
  font-size: 0.95rem;
  font-weight: 600;
  display: inline-block;
  margin: 12px 0 6px 0;
}
input[type="text"], textarea {
  width: 100%;
  padding: 8px 10px;
  border: 1px solid #ccc;
  border-radius: 5px;
  margin-bottom: 12px;
  font-size: 1rem;
}

/* ===== Tables ===== */
table {
  width: 100%;
  border-collapse: collapse;
  margin-bottom: 20px;
  font-size: 0.95rem;
}

th, td {
  padding: 6px 8px;
  border: 1px solid #ccc;
  text-align: center;
}

table thead th {
  position: sticky;
  top: 0;
  z-index: 3;
  background: #fafafa;
}
table .subhdr th {
  position: sticky;
  top: 28px;
  z-index: 2;
  background: #f0f0f0;
}

/* ===== Buttons ===== */
:root {
  --btn-size: 34px;
  --btn-font: 16px;
  --btn-pad-y: 6px;
  --btn-pad-x: 8px;
  --qty-min: 16px;
}

.btn {
  background: #003366;
  color: #fff;
  border: none;
  border-radius: 4px;
  padding: var(--btn-pad-y) var(--btn-pad-x);
  font-size: var(--btn-font);
  cursor: pointer;
  min-width: var(--btn-size);
  min-height: var(--btn-size);
}
.btn:hover { background: #0055a5; }
.btn:active { background: #001f3d; }

.btnrow {
  display: flex;
  flex-wrap: nowrap;
  gap: 8px;
  justify-content: center;
  align-items: center;
}

.qty {
  font-size: 14px;
  min-width: var(--qty-min);
}

/* Reset button */
#resetBtn {
  background: #cc0000;
}
#resetBtn:hover {
  background: #e60000;
}

/* LH / RH background colors */
th.lh-group, td.lh-group {
  background: #eaf3ff !important;
}
th.rh-group, td.rh-group {
  background: #fff2d9 !important;
}
th.lh-end, td.lh-end {
  border-right: 4px solid #111 !important;
}

@media (max-width: 600px) {
  :root {
    --btn-size: 30px;
    --btn-font: 15px;
    --btn-pad-y: 4px;
    --btn-pad-x: 6px;
    --qty-min: 14px;
  }
}

</style>
</head>

<body>
<div class="container">

<h1>BFS Interior Door Takeoff</h1>

<!-- ===== TOP SECTION — Customer & Lot ONLY ===== -->
<label for="customer">Customer:</label>
<input type="text" id="customer" placeholder="Enter customer name" />

<label for="lot">Lot #:</label>
<input type="text" id="lot" placeholder="Enter lot number" />


<!-- ============================================================
     JS START — This will insert all door tables + bottom section
     ============================================================ -->
<script>

/* =======================================================
   =============== STATE MANAGEMENT ======================
   ======================================================= */

let state = {};
if (localStorage.getItem('BFSdoorState')) {
  try { state = JSON.parse(localStorage.getItem('BFSdoorState')); }
  catch(e) { state = {}; }
}

function save() {
  localStorage.setItem('BFSdoorState', JSON.stringify(state));
}

function resetAll() {
  state = {};
  document.getElementById("customer").value = "";
  document.getElementById("lot").value = "";
  document.getElementById("notes").value = "";
  document.getElementById("summaryText").value = "";
  save();
  render();
}

function bump(key, delta) {
  state[key] = Math.max(0, (state[key] || 0) + delta);
  save();
  render();
}

function kSingle(height, width, hand, type) {
  return `${height}_${width}_${hand}_${type}`;
}
function kDouble(group, size, hand, type) {
  return `${group}_${size}_${hand}_${type}`;
}

function cellButtons(key) {
  return `
    <div class="btnrow">
      <button class="btn" onclick="bump('${key}', -1)">–</button>
      <div class="qty">${state[key] || 0}</div>
      <button class="btn" onclick="bump('${key}', 1)">+</button>
    </div>
  `;
}


/* =======================================================
   =============== RENDER SECTIONS ========================
   ======================================================= */

function renderSingles(height, widths) {
  let html = `
    <div class="section-title">Door ${height}</div>
    <table>
      <thead>
        <tr>
          <th style="width:60px;">Size</th>
          <th colspan="2" class="lh-group lh-end">LH</th>
          <th colspan="2" class="rh-group">RH</th>
        </tr>
        <tr class="subhdr">
          <th></th>
          <th class="lh-group lh-end">Unit</th>
          <th class="lh-group lh-end">Slab</th>
          <th class="rh-group">Unit</th>
          <th class="rh-group">Slab</th>
        </tr>
      </thead>
      <tbody>
  `;

  widths.forEach(w => {
    html += `
      <tr>
        <td>${w}</td>
        <td class="lh-group lh-end">${cellButtons(kSingle(height, w, "LH", "unit"))}</td>
        <td class="lh-group lh-end">${cellButtons(kSingle(height, w, "LH", "slab"))}</td>
        <td class="rh-group">${cellButtons(kSingle(height, w, "RH", "unit"))}</td>
        <td class="rh-group">${cellButtons(kSingle(height, w, "RH", "slab"))}</td>
      </tr>
    `;
  });

  html += `</tbody></table>`;
  return html;
}


function renderDoubles(group, sizes) {
  let html = `
    <div class="section-title">${group}</div>
    <table>
      <thead>
        <tr>
          <th style="width:60px;">Size</th>
          <th class="lh-group">Unit</th>
          <th class="rh-group">French</th>
        </tr>
      </thead>
      <tbody>
  `;

  sizes.forEach(size => {
    html += `
      <tr>
        <td>${size}</td>
        <td class="lh-group">${cellButtons(kDouble(group, size, "NA", "unit"))}</td>
        <td class="rh-group">${cellButtons(kDouble(group, size, "NA", "french"))}</td>
      </tr>
    `;
  });

  html += `</tbody></table>`;
  return html;
}


function renderTastDoubles(sizes) {
  let html = `
    <div class="section-title">T-Astragal</div>
    <table>
      <thead>
        <tr>
          <th style="width:60px;">Size</th>
          <th colspan="2" class="lh-group lh-end">LH</th>
          <th colspan="2" class="rh-group">RH</th>
        </tr>
        <tr class="subhdr">
          <th></th>
          <th class="lh-group lh-end">Unit</th>
          <th class="lh-group lh-end">French</th>
          <th class="rh-group">Unit</th>
          <th class="rh-group">French</th>
        </tr>
      </thead>
      <tbody>
  `;

  sizes.forEach(size => {
    html += `
      <tr>
        <td>${size}</td>
        <td class="lh-group lh-end">${cellButtons(kDouble("T-Astragal", size, "LH", "unit"))}</td>
        <td class="lh-group lh-end">${cellButtons(kDouble("T-Astragal", size, "LH", "french"))}</td>
        <td class="rh-group">${cellButtons(kDouble("T-Astragal", size, "RH", "unit"))}</td>
        <td class="rh-group">${cellButtons(kDouble("T-Astragal", size, "RH", "french"))}</td>
      </tr>
    `;
  });

  html += `</tbody></table>`;
  return html;
}


/* ===== Pull-Down Stairs ===== */
function renderPullDownStairs() {
  return `
    <div class="section-title">Pull-Down Stairs</div>
    <table>
      <thead>
        <tr>
          <th>Size</th>
          <th class="lh-group">Qty</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>22-1/2"</td>
          <td class="lh-group">${cellButtons("PDS_22.5")}</td>
        </tr>
        <tr>
          <td>25"</td>
          <td class="lh-group">${cellButtons("PDS_25")}</td>
        </tr>
      </tbody>
    </table>
  `;
}






/* =======================================================
   ========== SUMMARY GENERATION WITH SORTING =============
   ======================================================= */

function generateSummary() {
  const cust = document.getElementById("customer").value.trim();
  const lot  = document.getElementById("lot").value.trim();
  const notes = document.getElementById("notes").value.trim();

  const sections = {
    "6/8 Doors": [],
    "8/0 Doors": [],
    "DBL Doors": [],
    "T-Ast Doors": [],
    "Pull-Down Stairs": []
  };

  Object.entries(state).forEach(([key, qty]) => {
    if (!qty || qty <= 0) return;
    if (key.startsWith("6/8_")) sections["6/8 Doors"].push([key, qty]);
    else if (key.startsWith("8/0_")) sections["8/0 Doors"].push([key, qty]);
    else if (key.startsWith("DBL_")) sections["DBL Doors"].push([key, qty]);
    else if (key.startsWith("T-Astragal_")) sections["T-Ast Doors"].push([key, qty]);
    else if (key.startsWith("PDS_")) sections["Pull-Down Stairs"].push([key, qty]);
  });

  const sizeOrderSingles = ["1/6","2/0","2/4","2/6","2/8","3/0"];
  const handOrder = ["LH","RH"];
  const typeOrderSingles = ["unit","slab"];

  const sizeOrderDoubles = ["3/0","4/0","4/8","5/0","5/4","6/0"];
  const typeOrderDoubles = ["unit","french"];

  function sortSingles(a,b){
    const [ha,wa,handA,typeA] = a[0].split("_");
    const [hb,wb,handB,typeB] = b[0].split("_");
    return (
      sizeOrderSingles.indexOf(wa) - sizeOrderSingles.indexOf(wb) ||
      handOrder.indexOf(handA) - handOrder.indexOf(handB) ||
      typeOrderSingles.indexOf(typeA) - typeOrderSingles.indexOf(typeB)
    );
  }

  function sortDoubles(a,b,withHand){
    const pa=a[0].split("_"), pb=b[0].split("_");
    const sizeA=pa[1], sizeB=pb[1];
    const handA=pa[2], handB=pb[2];
    const typeA=pa[3], typeB=pb[3];
    return (
      sizeOrderDoubles.indexOf(sizeA) - sizeOrderDoubles.indexOf(sizeB) ||
      (withHand ? handOrder.indexOf(handA) - handOrder.indexOf(handB) : 0) ||
      typeOrderDoubles.indexOf(typeA) - typeOrderDoubles.indexOf(typeB)
    );
  }

  const fmtSingles = (key, qty) => {
    const [height, width, hand, type] = key.split("_");
    const typeLabel = (type === "unit") ? "Unit" : "Slab";
    return `${width} ${hand} ${typeLabel}: ${qty}`;
  };

  const fmtDbl = (key, qty) => {
    const parts = key.split("_");
    const group = parts[0];
    const size  = parts[1];
    const hand  = parts[2];
    const type  = parts[3];
    const typeLabel = (type === "unit") ? "Unit" : "French";
    if (group === "DBL") return `${size} ${typeLabel}: ${qty}`;
    return `${size} ${hand} ${typeLabel}: ${qty}`;
  };

  const fmtPDS = (key, qty) => {
    if (key === "PDS_22.5") return `22-1/2": ${qty}`;
    if (key === "PDS_25") return `25": ${qty}`;
    return `${key}: ${qty}`;
  };

  let s = "";
  if (cust) s += `Customer: ${cust}\n`;
  if (lot)  s += `Lot #: ${lot}\n`;
  if (cust || lot) s += "\n";

  Object.entries(sections).forEach(([title, items]) => {
    if (!items.length) return;

    if (title === "6/8 Doors" || title === "8/0 Doors") {
      items.sort(sortSingles);
    } else if (title === "DBL Doors") {
      items.sort((a,b)=>sortDoubles(a,b,false));
    } else if (title === "T-Ast Doors") {
      items.sort((a,b)=>sortDoubles(a,b,true));
    }

    s += `${title}\n`;
    s += `${"-".repeat(title.length)}\n`;
    items.forEach(([key, qty]) => {
      if (key.startsWith("6/8_") || key.startsWith("8/0_")) s += fmtSingles(key, qty) + "\n";
      else if (key.startsWith("DBL_") || key.startsWith("T-Astragal_")) s += fmtDbl(key, qty) + "\n";
      else if (key.startsWith("PDS_")) s += fmtPDS(key, qty) + "\n";
    });
    s += "\n";
  });

  if (notes) {
    s += `NOTES\n-----\n${notes}\n`;
  }

  document.getElementById("summaryText").value = s.trim();
}



/* =======================================================
   ================= COPY SUMMARY BUTTON ==================
   ======================================================= */

function copySummary(){
  const ta = document.getElementById("summaryText");
  const text = ta.value || "";

  if(!text.trim()){
    alert("Summary text is empty.");
    return;
  }

  ta.focus();
  ta.select();
  ta.setSelectionRange(0, text.length);

  navigator.clipboard?.writeText(text).then(()=>{
    alert("Summary copied to clipboard!");
  }).catch(()=>{
    try{
      document.execCommand("copy");
      alert("Summary copied to clipboard!");
    }catch(e){
      alert("Copy failed. Please press and hold to copy manually.");
    }
  });
}




/* =======================================================
   ===================== RENDER PAGE ======================
   ======================================================= */

function render() {

  let root = document.querySelector(".container");

  let content = `
    <h1>BFS Interior Door Takeoff</h1>

    <label for="customer">Customer:</label>
    <input type="text" id="customer" placeholder="Enter customer name"
      value="${document.getElementById("customer")?.value || ''}" />

    <label for="lot">Lot #:</label>
    <input type="text" id="lot" placeholder="Enter lot number"
      value="${document.getElementById("lot")?.value || ''}" />

    ${renderSingles("6/8", ["1/6","2/0","2/4","2/6","2/8","3/0"])}
    ${renderSingles("8/0", ["1/6","2/0","2/4","2/6","2/8","3/0"])}
    ${renderDoubles("DBL", ["3/0","4/0","4/8","5/0","5/4","6/0"])}
    ${renderTastDoubles(["3/0","4/0","4/8","5/0","5/4","6/0"])}
    ${renderPullDownStairs()}

    <label for="notes">Notes (field):</label>
    <textarea id="notes" rows="3">${document.getElementById("notes")?.value || ''}</textarea>

    <button id="generateBtn" class="btn" onclick="generateSummary()">Generate Summary Text</button>

    <label for="summaryText">Summary Text (copy/paste):</label>
    <textarea id="summaryText" rows="8">${document.getElementById("summaryText")?.value || ''}</textarea>

    <button id="copyBtn" class="btn" onclick="copySummary()">Copy Summary Text</button>

    <button id="resetBtn" class="btn" onclick="resetAll()">Reset All</button>
  `;

  root.innerHTML = content;
}

render();

</script>

</div>
</body>
</html>
